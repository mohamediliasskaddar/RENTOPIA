<!-- src/app/features/listings/components/property-card/property-card.component.html -->

<div class="property-card" [routerLink]="['/property', property.propertyId]">

  <!-- ========================================
       IMAGE SECTION
  ========================================= -->
  <div class="property-image">
    <img
      [src]="getCoverImage()"
      [alt]="property.title"
      (error)="onImageError($event)"
      loading="lazy"
    >

    <!-- Discount Badge -->
    <div class="discount-badge" *ngIf="getDiscount()">
      <mat-icon class="discount-icon">local_offer</mat-icon>
      <span>{{ getDiscount() }}% OFF</span>
    </div>

    <!-- Favorite Button (optionnel) -->
    <button
      mat-icon-button
      class="favorite-btn"
      (click)="$event.stopPropagation(); $event.preventDefault()">
      <mat-icon>favorite_border</mat-icon>
    </button>
  </div>

  <!-- ========================================
       PROPERTY INFO
  ========================================= -->
  <div class="property-info">

    <!-- Title & Location -->
    <div class="property-header">
      <h3 class="property-title">{{ property.title }}</h3>
      <p class="property-location">
        <mat-icon class="location-icon">location_on</mat-icon>
        {{ property.city }}, {{ property.country }}
      </p>
    </div>

    <!-- Details (guests, bedrooms, bathrooms) -->
    <div class="property-details">

      <span class="separator">•</span>
      <span class="detail-item">
        <mat-icon>bed</mat-icon>
        {{ property.bedrooms }} bedrooms
      </span>
      <span class="separator">•</span>
      <span class="detail-item">
        <mat-icon>bathroom</mat-icon>
        {{ property.bathrooms }} baths
      </span>
    </div>

    <!-- Rating (si disponible) -->
    <div class="property-rating" *ngIf="getAverageRating()">
      <mat-icon class="star-icon">star</mat-icon>
      <span class="rating-value">{{ getAverageRating() }}</span>
      <span class="review-count" *ngIf="getReviewCount()">
        ({{ getReviewCount() }} reviews)
      </span>
    </div>

    <!-- Price -->
    <div class="property-footer">
      <div class="property-price">
        <!-- Prix principal en ETH -->
        <div class="price-main">
          <span class="price-amount">{{ getDisplayPrice() | ethPrice:false:true }}</span>
          <span class="price-label">/ {{ getPriceLabel() }}</span>
        </div>

        <!-- Conversion EUR (sous le prix ETH) -->
        <div class="price-conversion">
          ≈ €{{ (getDisplayPrice() | ethPrice:true:true).split('€')[1] }}
        </div>
      </div>

      <!-- Nights (mode search) -->
      <div class="property-nights" *ngIf="getNights()">
        <mat-icon class="nights-icon">nights_stay</mat-icon>
        <span>{{ getNights() }} night{{ getNights()! > 1 ? 's' : '' }}</span>
      </div>
    </div>
  </div>

</div>

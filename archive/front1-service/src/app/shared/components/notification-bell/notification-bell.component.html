<!-- src/app/shared/components/notification-bell/notification-bell.component.html -->

<button
  mat-icon-button
  [matMenuTriggerFor]="notificationMenu"
  class="notification-btn"
  (menuOpened)="onMenuOpened()"
  matTooltip="Notifications">
  <mat-icon
    [matBadge]="badgeCount"
    matBadgeColor="warn"
    matBadgeSize="small">
    notifications
  </mat-icon>
</button>

<mat-menu #notificationMenu="matMenu" class="notification-menu">
  <!-- Header -->
  <div class="notification-header" (click)="$event.stopPropagation()">
    <h3>Notifications</h3>
    @if (unreadCount > 0) {
      <button mat-button color="primary" (click)="markAllRead($event)">
        Mark all read
      </button>
    }
  </div>

  <mat-divider></mat-divider>

  <!-- Loading State -->
  @if (loading) {
    <div class="notification-loading">
      <mat-spinner diameter="24"></mat-spinner>
      <p>Loading...</p>
    </div>
  }
  <!-- Empty State -->
  @else if (notifications.length === 0) {
    <div class="notification-empty">
      <mat-icon>notifications_off</mat-icon>
      <p>No new notifications</p>
    </div>
  }
  <!-- Notifications List -->
  @else {
    <div class="notification-list">
      @for (notification of notifications; track notification.id) {
        <div
          class="notification-item"
          [class.unread]="!notification.isRead"
          (click)="onNotificationClick(notification)"
          matRipple>

          <!-- Icon -->
          <div
            class="notification-icon"
            [style.background-color]="getColor(notification.notificationType)">
            <mat-icon>{{ getIcon(notification.notificationType) }}</mat-icon>
          </div>

          <!-- Content -->
          <div class="notification-content">
            <div class="notification-header-text">
              <span class="notification-type">{{ getTypeLabel(notification.notificationType) }}</span>
              <span class="notification-time">{{ getTimeAgo(notification.createdAt) }}</span>
            </div>
            <span class="notification-title">{{ notification.title }}</span>
            <span class="notification-message">{{ notification.message }}</span>
          </div>

          <!-- Actions -->
          <div class="notification-actions" (click)="$event.stopPropagation()">
            <button
              mat-icon-button
              matTooltip="Delete"
              (click)="deleteNotification(notification, $event)">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      }
    </div>

    <mat-divider></mat-divider>

    <!-- View All Button -->
    <div class="notification-footer">
      <button mat-button color="primary" (click)="viewAll()" class="view-all-btn">
        View all notifications
      </button>
    </div>
  }
</mat-menu>
